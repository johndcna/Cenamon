name: CI-CD

on:
  workflow_dispatch:
  push:
    branches:
      - master # master environment
      # - release # staging and production 

jobs:

  build-core-api:
    uses: johndcna/reusable-workflows/.github/workflows/build-dotnet.yml@main
    with:
      dotnet_version: 8.x
      artifact_name: 'Cenamon.WebAPI'
      project_file: 'Cenamon/Cenamon.WebAPI.csproj'
      
  deploy-core-api:
    needs: [build-core-api]
    uses: johndcna/reusable-workflows/.github/workflows/deploy-.net-to-azure-web-app.yml@main
    with:
      artifact_name: 'Cenamon.WebAPI'
      target_app_name: ${{ vars.AZURE_WEBAPP_NAME }}
      target_publish_profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
